name: Keep Render Service Alive

on:
  schedule:
    # Run every 10 minutes to ensure Render doesn't sleep (cold starts take 30-60s)
    - cron: "*/10 * * * *"
  workflow_dispatch:  # Allow manual triggering

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Fail-safe to prevent hung jobs
    steps:
      - name: Ping Render Subdomain
        run: |
          curl -o /dev/null \
            --silent \
            --show-error \
            --fail \
            --max-time 120 \
            --retry 3 \
            --retry-delay 10 \
            --retry-max-time 300 \
            -H "User-Agent: Mozilla/5.0 (compatible; GitHubActions/1.0; +https://github.com)" \
            -w "Subdomain: %{http_code} (Time: %{time_total}s)\n" \
            "https://dearnco-django.onrender.com" || echo "Primary subdomain ping failed, but continuing..."

      - name: Ping Custom Domain (dearnco.is-a.dev)
        run: |
          curl -o /dev/null \
            --silent \
            --show-error \
            --fail \
            --max-time 120 \
            --retry 3 \
            --retry-delay 10 \
            --retry-max-time 300 \
            -H "User-Agent: Mozilla/5.0 (compatible; GitHubActions/1.0; +https://github.com)" \
            -w "Custom (dearnco): %{http_code} (Time: %{time_total}s)\n" \
            "https://dearnco.is-a.dev" || echo "dearnco.is-a.dev ping failed, but continuing..."

      - name: Ping Custom Domain (dear.is-a.dev)
        run: |
          curl -o /dev/null \
            --silent \
            --show-error \
            --fail \
            --max-time 120 \
            --retry 3 \
            --retry-delay 10 \
            --retry-max-time 300 \
            -H "User-Agent: Mozilla/5.0 (compatible; GitHubActions/1.0; +https://github.com)" \
            -w "Custom (dear): %{http_code} (Time: %{time_total}s)\n" \
            "https://dear.is-a.dev" || echo "dear.is-a.dev ping failed, but continuing..."

      - name: Log Success
        run: echo "âœ… All pings completed at $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
