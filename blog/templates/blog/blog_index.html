{% extends 'base.html' %}
{% load static %}

{% block title %}Blog | Dear&Co{% endblock %}

{% block content %}
<section class="blog-hero">
    <div class="container">
        <h1>The Growth Playbook</h1>
        <p>Insights, strategies, and stories from the forefront of digital innovation.</p>
    </div>
</section>

<section class="blog-main">
    <div class="container">
        {% if featured_posts %}
        <div class="featured-spotlight">
            {% with featured_posts.0 as post %}
            <a href="{{ post.get_absolute_url }}" class="featured-card">
                {% if post.header_image %}<img src="{{ post.header_image.url }}" alt="{{ post.title }}">{% else %}<div
                    class="placeholder-image"></div>{% endif %}
                <div class="overlay-content">
                    <span class="tag">Featured</span>
                    <h2>{{ post.title }}</h2>
                    <p>{{ post.subtitle }}</p>
                </div>
            </a>
            {% endwith %}
        </div>
        {% endif %}

        <div class="tag-filters">
            <label for="tag-select" class="sr-only">Filter by tag</label>
            <select id="tag-select" class="tag-dropdown">
                <option value="all" selected>All Topics</option>
                {% for tag in all_tags %}
                <option value="{{ tag.name|slugify }}">{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="blog-grid">
            {% for post in non_featured_posts %}
            <div class="blog-card-wrapper animate-on-scroll"
                data-tags="{% for tag in post.tags.all %}{{ tag.name|slugify }},{% endfor %}">
                <a href="{{ post.get_absolute_url }}" class="blog-card">
                    {% if post.header_image %}<img src="{{ post.header_image.url }}" alt="{{ post.title }}"
                        class="card-img">{% else %}<div class="placeholder-image card-img"></div>{% endif %}
                    <div class="card-content">
                        <h4>{{ post.title }}</h4>
                        <p>{{ post.subtitle }}</p>
                        <div class="author-info">
                            {# BULLETPROOF FIX: This safely checks for the profile and then the image, preventing any
                            crashes. #}
                            {% if post.author.profile and post.author.profile.image %}
                            <img src="{{ post.author.profile.image.url }}"
                                alt="{{ post.author.get_full_name|default:post.author.username }}">
                            {% else %}
                            <div class="default-avatar-small">{{ post.author.username|first|upper }}</div>
                            {% endif %}
                            <span>{{ post.author.get_full_name|default:post.author.username }} &bull; {{
                                post.published_date|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}