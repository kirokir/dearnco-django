{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} | Dear&Co Blog{% endblock %}

{% block content %}
<article class="blog-post-detail">

    {# CRITICAL FIX: The entire style attribute is now conditional. It will only be rendered if a valid header image URL
    exists. #}
    <header class="post-header" {% if post.header_image and post.header_image.url
        %}style="background-image: url('{{ post.header_image.url }}')" {% endif %}>
        <div class="container">
            <div class="post-meta">
                {% for tag in post.tags.all %}
                <a href="#" class="tag">{{ tag.name }}</a>
                {% endfor %}
            </div>

            <h1>{{ post.title }}</h1>

            {# Safety Check: Only render the subtitle if it exists to avoid an empty h2 tag. #}
            {% if post.subtitle %}
            <h2>{{ post.subtitle }}</h2>
            {% endif %}

            <div class="author-info">
                {# BULLETPROOF FIX: This nested check first confirms a profile exists, then confirms the image exists,
                preventing any crashes. #}
                {% if post.author.profile %}
                {% if post.author.profile.image and post.author.profile.image.url %}
                <img src="{{ post.author.profile.image.url }}"
                    alt="{{ post.author.get_full_name|default:post.author.username }}">
                {% else %}
                <div class="default-avatar">{{ post.author.username|first|upper }}</div>
                {% endif %}
                {% else %}
                <div class="default-avatar">{{ post.author.username|first|upper }}</div>
                {% endif %}
                <span>By {{ post.author.get_full_name|default:post.author.username }} on {{ post.published_date|date:"F
                    j, Y" }}</span>
            </div>
        </div>
    </header>

    <div class="post-content container">
        {# Safety Check: Ensure content exists before attempting to render it. #}
        {% if post.content %}
        {{ post.content|safe }}
        {% else %}
        <p><em>No content available for this post.</em></p>
        {% endif %}
    </div>
</article>
{% endblock %}