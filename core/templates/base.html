{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dear&Co | Digital Agency{% endblock %}</title>
    <meta name="description" content="{{ site_config.meta_description }}">
    <meta name="keywords" content="{{ site_config.meta_keywords }}">
    <meta name="author" content="Dear&Co">

    <!-- âœ… Google Site Verification -->
    <meta name="google-site-verification" content="zevlnVJwsTbhMKdrKkanaT_JNHidO191GdLw6gMtqDc" />

    <!-- âœ… Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WHXGGGHX');
    </script>
    <!-- End Google Tag Manager -->

    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png">
    <link rel="apple-touch-icon" href="{% static 'img/icon-192x192.png' %}">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    {% block extra_head %}{% endblock %}
</head>

<body class="{{ body_class }}">

    <!-- âœ… Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHXGGGHX" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header id="sticky-header">
        <nav>
            <a href="{% url 'core:home' %}">Home</a>
            <a href="{% url 'agency:about' %}">About</a>
            <a href="{% url 'blog:blog_index' %}">Blog</a>
            <a href="#">Work</a>
            <a href="#" class="cta-button">Let's talk</a>
        </nav>
    </header>

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer class="site-footer" style="background-image: url('{{ site_config.footer_background_image.url }}');">
        <div class="footer-container">
            <div class="footer-column">
                <h3>Your next project starts here.</h3>
                <a href="#" class="footer-cta">Become a Partner â†’</a>
            </div>
            <div class="footer-column">
                <h4>Company</h4>
                <ul>
                    <li><a href="{% url 'agency:about' %}">Our Team</a></li>
                    <li><a href="#">Portfolio</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Terms & Conditions</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Connect</h4>
                <address>
                    {% for location in office_locations %}
                    <a href="{{ location.google_maps_link }}" target="_blank" rel="noopener">{{ location.address
                        }}</a><br>
                    {% endfor %}
                </address>
                <div class="footer-socials">
                    <a href="mailto:{{ site_config.email }}">Email</a>
                    <a href="https://wa.me/{{ site_config.phone_number }}" target="_blank" rel="noopener">WhatsApp</a>
                    <!-- FIX: Corrected variable name from site_config.linkedin_url to site_config.linkedin -->
                    <a href="{{ site_config.linkedin }}" target="_blank" rel="noopener">LinkedIn</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {% now "Y" %} Dear&Co. All rights reserved.</p>
        </div>
    </footer>

    <div id="game-indicator">Game Below</div>
    <footer id="game-footer">
        <h2>CATCH ME IF YOU CAN!</h2>
        <div class="game-area">
            <div class="hole">
                <div class="mole"></div>
            </div>
            <div class="hole">
                <div class="mole"></div>
            </div>
            <div class="hole">
                <div class="mole"></div>
            </div>
            <div class="hole">
                <div class="mole"></div>
            </div>
            <div class="hole">
                <div class="mole"></div>
            </div>
            <div class="hole">
                <div class="mole"></div>
            </div>
        </div>
    </footer>

    <div class="floating-widgets">
        <button id="scrollToTopBtn" title="Go to top">â†‘</button>
        <a href="https://wa.me/{{ site_config.phone_number }}" id="whatsapp-widget" target="_blank" rel="noopener">
            <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"
                class="iconify iconify--icomoon-free" preserveAspectRatio="xMidYMid meet">
                <path
                    d="M22.339 17.445c-.275-.138-1.625-.802-1.877-.893-.252-.091-.436-.138-.62.138-.184.275-.709.893-.87.1.069-.184.368-.46.62-.751s.169-.552.252-.921.042-1.688-.237-1.877c-.275-.184-.62-.184-.87-.184-.252 0-1.65.62-2.884 2.884-1.234 2.264-1.234 2.884-1.234 2.884s-1.107-.123-2.222-.656c-2.45-1.173-3.088-2.529-3.088-2.529s-1.107 1.481.275 3.315c1.382 1.833 2.222 3.447 3.447 4.562s2.529 1.107 4.562 1.107c2.033 0 3.315-1.107 3.315-1.107s.275-2.222.138-2.529c-.138-.308-.308-.436-.656-.436h-.436zm-6.339 14.555c-8.835 0-16-7.165-16-16s7.165-16 16-16 16 7.165 16 16-7.165 16-16 16zm0-30c-7.73 0-14 6.27-14 14s6.27 14 14 14 14-6.27 14-14-6.27-14-14-14z"
                    fill="currentColor"></path>
            </svg>
        </a>
        <button id="darkModeToggle">ðŸŒ™</button>
    </div>

    <div id="pwa-install-prompt" class="pwa-prompt" style="display: none;">
        <p>Add Dear&Co to your Home Screen?</p>
        <button id="pwa-install-button">Install</button>
        <button id="pwa-dismiss-button">Later</button>
    </div>

    <nav id="bottom-nav">
        <a href="{% url 'core:home' %}">Home</a>
        <a href="{% url 'agency:about' %}">About</a>
        <a href="{% url 'blog:blog_index' %}">Blog</a>
        <a href="#">Work</a>
        <a href="#" class="cta">Let's Talk</a>
    </nav>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // FIX: Corrected URL name from 'sw' to 'sw.js'
                navigator.serviceWorker.register("{% url 'sw.js' %}")
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>
